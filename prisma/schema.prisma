// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"  // postgresql -> sqlite로 변경
  url      = env("DATABASE_URL")
}

model User {
  id            String         @id @default(uuid())
  studentId     String         @unique // @db.VarChar(8) 제거
  passwordHash  String
  name          String
  createdAt     DateTime       @default(now()) // @db.Timestamptz(6) 제거
  updatedAt     DateTime       @default(now()) @updatedAt // @db.Timestamptz(6) 제거
  
  // Relations
  reservations  Reservation[]  @relation("UserReservations")
  transfers     Market[]       @relation("OriginalUser")
  
  @@map("users")
}

model Room {
  id           Int            @id @default(autoincrement())
  name         String         @unique
  type         String         // enum 대신 String 사용
  capacity     Int
  floor        Int
  createdAt    DateTime       @default(now()) // @db.Timestamptz(6) 제거
  updatedAt    DateTime       @default(now()) @updatedAt // @db.Timestamptz(6) 제거
  
  // Relations
  reservations Reservation[]
  
  @@map("rooms")
}

model Reservation {
  id          String      @id @default(uuid())
  userId      String
  roomId      Int
  date        DateTime    // @db.Date 제거
  startTime   DateTime    // @db.Timestamptz(6) 제거
  endTime     DateTime    // @db.Timestamptz(6) 제거
  status      String      @default("ACTIVE") // enum 대신 String, 기본값 문자열로
  createdAt   DateTime    @default(now()) // @db.Timestamptz(6) 제거
  updatedAt   DateTime    @default(now()) @updatedAt // @db.Timestamptz(6) 제거
  
  // Relations
  user        User        @relation("UserReservations", fields: [userId], references: [id], onDelete: Cascade)
  room        Room        @relation(fields: [roomId], references: [id])
  market      Market?
  
  @@index([date, roomId])
  @@index([userId, date])
  @@map("reservations")
}

model Market {
  id              String      @id @default(uuid())
  reservationId   String      @unique
  originalUserId  String
  description     String?
  isAvailable     Boolean     @default(true) // SQLite는 Boolean 지원
  createdAt       DateTime    @default(now()) // @db.Timestamptz(6) 제거
  updatedAt       DateTime    @default(now()) @updatedAt // @db.Timestamptz(6) 제거
  
  // Relations
  reservation     Reservation @relation(fields: [reservationId], references: [id], onDelete: Cascade)
  originalUser    User        @relation("OriginalUser", fields: [originalUserId], references: [id])
  
  @@map("market")
}

